!function(t,e,n,i){function s(e,n){this.el=e,this.$el=t(e),this.$el.wrapAll('<div class="jmap-container"></div>'),this.$parent=this.$el.parent(),this.settings=t.extend({},t.fn[r].defaults,n),this.map=null,this.center=null,this.markers=null,this.map_markers=[],this.init()}var r="jMap";s.prototype={init:function(){"object"==typeof google&&"object"==typeof google.maps?(this._renderMap(),this._aspectRatio()):this._error("Google Maps API is not loaded. Load it before loading jMap.")},_runFunction:function(t,e){"function"==typeof t&&t.call(this,e)},_renderMap:function(){this._findMarkers(),0===this.$el.height()&&(this._error("Container has no height. Setting it to "+this.settings.height+"px."),this.$el.height(this.settings.height));var t="";switch(this.settings.type){case"hybrid":t=google.maps.MapTypeId.HYBRID;case"satellite":t=google.maps.MapTypeId.SATELLITE;case"terrain":t=google.maps.MapTypeId.TERRAIN;default:t=google.maps.MapTypeId.ROADMAP}var e={center:new google.maps.LatLng(this.settings.lat,this.settings.lng),zoom:this.settings.zoom,mapTypeId:t};this._runFunction(this.settings.beforeMapInit),this.map=new google.maps.Map(this.$el[0],e),this._runFunction(this.settings.afterMapInit),this._runFunction(this.settings.beforeMarkerAdd),this._addMarkers(),this._runFunction(this.settings.afterMarkerAdd),this.settings.centerMarkers?(this._runFunction(this.settings.beforeCenter),this.centerMap(),this._runFunction(this.settings.afterCenter)):(this._runFunction(this.settings.beforeGeoCenter),this.geoCenter(),this._runFunction(this.settings.afterGeoCenter)),this._doCenter()},_doCenter:function(){if(null!==this.center){var t=this;google.maps.event.addDomListener(e,"resize",function(){t.map.setCenter(t.center)})}},_findMarkers:function(){var e=[];this.$el.find("div.marker").each(function(){var n=t(this).data("lat"),i=t(this).data("lng"),s=t(this).html(),r={lat:n,lng:i,content:s};e.push(r)}),null!==this.settings.markers&&t.each(this.settings.markers,function(t,n){e.push(n)}),this.markers=e},_addMarkers:function(){if(null!==this.markers){var e=this;t.each(this.markers,function(t,n){e.addMarker(n)})}},_error:function(t){this.settings.debug===!0&&console.error(t)},_aspectRatio:function(){if(this.settings.aspectRatio!==!1){var t=this.$parent,e=this.$el,n=56.25,i=this.settings.aspectRatio.split("/");n=i[1]/i[0]*100,t.css({position:"relative","padding-top":n+"%"}),e.css({position:"absolute",top:"0",bottom:"0",left:"0",right:"0",height:"auto"})}},addMarker:function(t){var e=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:this.map});this.map_markers.push(e);var n=this;if("undefined"!=typeof t.content){var i=new google.maps.InfoWindow({content:t.content});google.maps.event.addListener(e,"click",function(){i.open(this.map,e)})}if(t.events)for(var s in t.events)google.maps.event.addListener(e,s,function(){t.events[s].call(n,this,e,t)});return!0},centerMap:function(){var e=new google.maps.LatLngBounds;t.each(this.map_markers,function(t,n){var i=new google.maps.LatLng(n.position.lat(),n.position.lng());e.extend(i)}),1==this.map_markers.length?(this.map.setCenter(e.getCenter()),this.map.setZoom(16)):this.map.fitBounds(e),this.center=e.getCenter()},geoCenter:function(){if(navigator.geolocation){var t=this;navigator.geolocation.getCurrentPosition(function(e){var n=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);t.map.setCenter(n),this.center=n},function(e){t._error(e.message)})}else this._error("The user navigator is unavailiable.")},destroy:function(){this.$el.html(""),this.$el.attr("style",""),this.$el.removeData()},get:function(){return this.map}},t.fn[r]=function(e){var n=arguments;if(e===i||"object"==typeof e)return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new s(this,e))});if("string"==typeof e&&"_"!==e[0]&&"init"!==e){if(0==Array.prototype.slice.call(n,1).length&&-1!=t.inArray(e,t.fn[r].getters)){var a=t.data(this[0],"plugin_"+r);return a[e].apply(a,Array.prototype.slice.call(n,1))}return this.each(function(){var i=t.data(this,"plugin_"+r);i instanceof s&&"function"==typeof i[e]&&i[e].apply(i,Array.prototype.slice.call(n,1))})}},t.fn[r].getters=["get","geoCenter","centerMap"],t.fn[r].defaults={lat:62.1,lng:10.1,height:350,centerResize:!0,aspectRatio:"16/9",zoom:16,type:"roadmap",markers:null,centerMarkers:!0,geoCenter:!1,debug:!1,beforeMapInit:null,afterMapInit:null,beforeMarkerAdd:null,afterMarkerAdd:null,beforeCenter:null,afterCenter:null,beforeGeoCenter:null,afterGeoCenter:null}}(jQuery,window,document);